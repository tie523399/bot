# 🛒 購物車與結帳流程說明

## 購物車功能改進

### 1. 購物車顯示
當客戶點擊「🛍️ 購物車」按鈕時，會顯示：

```
🛒 購物車清單

📦 商品名稱
   單價: $100 × 2 = $200
   選項: 尺寸L, 藍色

📦 商品名稱2
   單價: $50 × 1 = $50

────────────────────
📊 統計資訊
商品種類：2 種
商品總數：3 件
💰 總金額：$250

[💳 購買] [🔙 返回]
```

### 2. 購買按鈕功能
- **💳 購買**：開始進入結帳流程
- **🔙 返回**：返回購物車管理畫面（可調整數量）

## 簡化的結帳流程

### 步驟 1：輸入姓名
```
📝 開始結帳

請輸入您的姓名：
```
**驗證規則：**
- 至少2個字，最多20個字
- 只能包含中文、英文和空格

### 步驟 2：輸入電話
```
✅ 姓名：王小明

請輸入您的手機號碼（格式：0912345678）：
```
**驗證規則：**
- 必須是09開頭的10碼數字
- 自動移除分隔符號（-、空格）

### 步驟 3：輸入店號
```
✅ 電話：0912345678

請點擊下方按鈕查詢7-11門市店號
查詢完成後，請直接輸入店號：

[🔍 查詢7-11門市]
```
**功能說明：**
- 點擊按鈕會開啟7-11門市查詢網頁
- 用戶查詢完成後，直接輸入店號即可

### 步驟 4：訂單確認
```
✅ 訂單已成功建立！

已通知客服處理，稍後會給您7-11訂單號追蹤

📋 訂單編號：TDR202412291430**
👤 姓名：王小明
📱 電話：0912345678
🏪 7-11店號：123456
💰 總金額：$250
📅 下單時間：2024-12-29 14:30

感謝您的購買！
```

## 訂單編號規則

格式：`TDR + YYYYMMDD + HHMM + 隨機2碼`

範例：`TDR20241229143099`
- TDR：固定前綴
- 20241229：日期
- 1430：時間（14:30）
- 99：隨機數字

## 管理員通知

當有新訂單時，所有管理員會收到：

```
🔔 新訂單通知 - 請趕快出貨

📋 訂單編號：TDR20241229143099
👤 客戶：王小明
📱 電話：0912345678
🏪 7-11店號：123456
💰 金額：$250

訂單明細：
• 商品名稱 x2 = $200
• 商品名稱2 x1 = $50

⏰ 下單時間：2024-12-29 14:30

請盡快處理此訂單！
```

## 特色功能

1. **簡化流程**：只需3步即可完成訂單
2. **即時驗證**：姓名、電話格式即時檢查
3. **便利查詢**：整合7-11門市查詢連結
4. **自動通知**：訂單建立後自動通知商家
5. **庫存管理**：下單時自動扣減庫存
6. **防止超賣**：結帳前再次驗證庫存

## 技術實現

- 使用 ConversationHandler 管理對話流程
- 正則表達式驗證輸入格式
- 自動生成唯一訂單編號
- 即時通知所有管理員 